{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/settings.css?v=5">
{% endblock %}

{% block content %}
<div class="settings-container">

    <div class="header-area mb-4">
        <h2>‚öôÔ∏è <span data-i18n="settings_title">Sistem Ayarlarƒ±</span></h2>
    </div>

    <div class="settings-tabs">
        <button class="tab-btn active" onclick="openTab(event, 'tab-appearance')">
            <i class="fas fa-paint-brush"></i> <span data-i18n="tab_appearance">G√∂r√ºn√ºm & Etiketler</span>
        </button>
        <button class="tab-btn" onclick="openTab(event, 'tab-profile')">
            <i class="fas fa-user-circle"></i> <span data-i18n="tab_profile">Profil Bilgileri</span>
        </button>
        <button class="tab-btn" onclick="openTab(event, 'tab-security')">
            <i class="fas fa-shield-alt"></i> <span data-i18n="tab_security">G√ºvenlik</span>
        </button>
    </div>

    <div id="tab-appearance" class="tab-content active">
        
        <div class="settings-card mb-4">
            <h3><i class="fas fa-globe"></i> <span data-i18n="settings_general_header">Genel Tercihler</span></h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label" data-i18n="settings_lang">Uygulama Dili</label>
                        <select id="languageSelect" class="form-control">
                            <option value="tr">üáπüá∑ T√ºrk√ße</option>
                            <option value="en">üá¨üáß English</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label" data-i18n="settings_theme">G√∂r√ºn√ºm Modu</label>
                        <select class="form-control input-disabled" disabled>
                            <option>Dark Mode (Varsayƒ±lan)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="settings-card mb-4">
            <h3><i class="fas fa-tags"></i> <span data-i18n="settings_tags_header">Etiket Y√∂netimi</span></h3>
            <p class="text-muted mb-4" data-i18n="settings_tags_desc">AI'nƒ±n maillerinizi otomatik olarak etiketlemesi i√ßin a≈üaƒüƒ±dan kategoriler olu≈üturun.</p>

            <div class="tag-grid">
                {% for tag in tags %}
                <div class="tag-item-card">
                    <div class="tag-color-strip" data-bg-color="{{ tag.color }}"></div>
                    <div class="tag-info">
                        <div class="tag-name-row">
                            <span class="tag-pill" data-bg-color="{{ tag.color }}">
                                <span data-i18n="tag_name_{{ tag.slug }}">{{ tag.name }}</span>
                            </span>
                        </div>
                        <div class="tag-desc" data-i18n="tag_desc_{{ tag.slug }}">{{ tag.description }}</div>
                    </div>
                    <div class="tag-actions">
                        <button type="button" title="D√ºzenle" onclick="openEditModal('{{ tag._id }}', '{{ tag.name }}', '{{ tag.color }}', '{{ tag.description }}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <form action="/ui/settings/tags/delete/{{ tag._id }}" method="post" class="d-inline">
                            <button type="submit" title="Sil" onclick="return confirm('Bu etiketi silmek istediƒüinize emin misiniz?');">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </div>
                {% else %}
                <div class="col-12 text-center py-4">
                    <p class="text-muted" data-i18n="settings_tags_empty">Hen√ºz hi√ß etiket tanƒ±mlanmamƒ±≈ü.</p>
                </div>
                {% endfor %}
            </div>

            <div class="add-tag-box">
                <h5 class="mb-3 text-muted"><i class="fas fa-plus-circle"></i> <span data-i18n="settings_tags_add_header">Yeni Etiket Ekle</span></h5>
                <form action="/ui/settings/tags/add" method="post" class="row align-items-end">
                    <div class="col-md-3 mb-2">
                        <label class="form-label small">Etiket Adƒ±</label>
                        <input type="text" name="name" class="form-control" placeholder="√ñrn: Fatura" required>
                    </div>
                    <div class="col-md-2 mb-2">
                        <label class="form-label small" data-i18n="settings_tags_label_color">Renk Se√ßin</label>
                        <input type="color" name="color" class="form-control settings-color-input" value="#3498db" title="Etiket Rengi">
                    </div>
                    <div class="col-md-5 mb-2">
                        <label class="form-label small" data-i18n="settings_tags_label_desc">A√ßƒ±klama (AI Kriteri)</label>
                        <input type="text" name="description" class="form-control" data-i18n="[placeholder]settings_tags_placeholder_desc" placeholder="√ñrn: √ñdeme ve dekont mailleri..." required>
                    </div>
                    <div class="col-md-2 mb-2">
                        <button type="submit" class="btn btn-primary settings-tag-submit w-100">
                            <i class="fas fa-plus"></i> <span data-i18n="btn_add">Ekle</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="tab-profile" class="tab-content">
        <form action="/ui/settings/update-profile" method="post">
            <div class="settings-card">
                <h3><i class="fas fa-user-circle"></i> <span data-i18n="settings_profile_header">Profil Bilgileri</span></h3>

                <div class="form-group">
                    <label data-i18n="settings_label_fullname" class="form-label">Tam Adƒ±nƒ±z</label>
                    <input type="text" name="full_name" value="{{ user.full_name }}" required>
                </div>

                <div class="form-group">
                    <label data-i18n="settings_label_signature" class="form-label">E-posta ƒ∞mzanƒ±z</label>
                    <textarea name="signature">{{ user.signature }}</textarea>
                    <p class="helper-text" data-i18n="settings_helper_signature">Onayladƒ±ƒüƒ±nƒ±z taslaklarƒ±n sonuna bu imza otomatik eklenir.</p>
                </div>

                <div class="form-group">
                    <label data-i18n="settings_label_verify" class="form-label">Doƒürulama: Panel ≈ûifreniz</label>
                    <input type="password" name="current_password" placeholder="Deƒüi≈üiklikleri kaydetmek i√ßin ≈üifrenizi girin" required>
                </div>

                <button type="submit" class="save-btn">
                    <i class="fas fa-user-check"></i> <span data-i18n="btn_update_profile">Profili G√ºncelle</span>
                </button>
            </div>
        </form>
    </div>

    <div id="tab-security" class="tab-content">
        <form action="/ui/settings/update-password" method="post">
            <div class="settings-card">
                <h3><i class="fas fa-lock"></i> <span data-i18n="settings_password_header">Panel Giri≈ü ≈ûifresi</span></h3>

                <div class="form-group">
                    <label data-i18n="settings_label_old_pass" class="form-label">Mevcut ≈ûifre</label>
                    <input type="password" name="old_password" required>
                </div>

                <div class="form-group">
                    <label data-i18n="settings_label_new_pass" class="form-label">Yeni ≈ûifre</label>
                    <input type="password" name="new_password" required>
                </div>

                <button type="submit" class="save-btn btn-warning">
                    <i class="fas fa-key"></i> <span data-i18n="btn_change_password">≈ûifreyi Deƒüi≈ütir</span>
                </button>
            </div>
        </form>
    </div>

</div>

<div class="modal fade" id="editTagModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Etiketi D√ºzenle</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editTagForm" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Etiket Adƒ±</label>
                        <input type="text" name="name" id="editName" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" data-i18n="settings_tags_label_color">Renk</label>
                        <input type="color" name="color" id="editColor" class="form-control settings-color-input settings-color-input-sm" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">A√ßƒ±klama</label>
                        <textarea name="description" id="editDesc" class="form-control" rows="3" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒ∞ptal</button>
                    <button type="submit" class="btn btn-primary">Kaydet</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function openEditModal(id, name, color, desc) {
        document.getElementById('editTagForm').action = "/ui/settings/tags/update/" + id;
        document.getElementById('editName').value = name;
        document.getElementById('editColor').value = color;
        document.getElementById('editDesc').value = desc;

        var modal = new bootstrap.Modal(document.getElementById('editTagModal'));
        modal.show();
    }
</script>
<script src="/static/js/translations.js?v=6"></script>
<script src="/static/js/language_engine.js?v=6"></script>
<script src="/static/js/settings.js?v=6"></script>
{% endblock %}
