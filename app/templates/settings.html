{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="/mail_ai/app/static/css/settings.css?v=5">
{% endblock %}

{% block content %}
<div class="settings-container">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>âš™ï¸ <span data-i18n="settings_title">Sistem AyarlarÄ±</span></h2>
    </div>

    <div class="settings-card mb-4">
        <h3><i class="fas fa-globe"></i> <span data-i18n="settings_general_header">Genel Tercihler</span></h3>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label class="form-label" data-i18n="settings_lang">Uygulama Dili</label>
                    <select id="languageSelect" class="form-control">
                        <option value="tr">ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
                        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label class="form-label" data-i18n="settings_theme">GÃ¶rÃ¼nÃ¼m Modu</label>
                    <select class="form-control input-disabled" disabled>
                        <option>Dark Mode (VarsayÄ±lan)</option>
                    </select>
                </div>
            </div>
        </div>
    </div>


    <!-- TAG YÃ–NETÄ°MÄ°-->
    <div class="settings-card mb-4">
        <h3><i class="fas fa-tags"></i> <span data-i18n="settings_tags_header">Etiket YÃ¶netimi</span></h3>
        <p class="text-muted mb-4" data-i18n="settings_tags_desc">AI'nÄ±n maillerinizi otomatik olarak etiketlemesi iÃ§in
            aÅŸaÄŸÄ±dan kategoriler oluÅŸturun.
        </p>

        <!-- Dynamic Grid Layout -->
        <div class="tag-grid">
            {% for tag in tags %}
            <div class="tag-item-card">
                <div class="tag-color-strip" data-bg-color="{{ tag.color }}"></div>

                <div class="tag-info">
                    <div class="tag-name-row">
                        <span class="tag-pill" data-bg-color="{{ tag.color }}">
                            <span data-i18n="tag_name_{{ tag.slug }}">{{ tag.name }}</span>
                        </span>
                    </div>
                    <div class="tag-desc" data-i18n="tag_desc_{{ tag.slug }}">{{ tag.description }}</div>
                </div>

                <div class="tag-actions">
                    <button type="button" title="DÃ¼zenle"
                        onclick="openEditModal('{{ tag._id }}', '{{ tag.name }}', '{{ tag.color }}', '{{ tag.description }}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <form action="/ui/settings/tags/delete/{{ tag._id }}" method="post" class="d-inline">
                        <button type="submit" title="Sil"
                            onclick="return confirm('Bu etiketi silmek istediÄŸinize emin misiniz?');">
                            <i class="fas fa-trash"></i>
                        </button>
                    </form>
                </div>
            </div>
            {% else %}
            <div class="col-12 text-center py-4">
                <p class="text-muted" data-i18n="settings_tags_empty">HenÃ¼z hiÃ§ etiket tanÄ±mlanmamÄ±ÅŸ. AÅŸaÄŸÄ±dan ilk
                    etiketinizi oluÅŸturun.</p>
            </div>
            {% endfor %}
        </div>

        <!-- Add Tag Form (Styled) -->
        <div class="add-tag-box">
            <h5 class="mb-3 text-muted"><i class="fas fa-plus-circle"></i> <span
                    data-i18n="settings_tags_add_header">Yeni Etiket Ekle</span></h5>
            <form action="/ui/settings/tags/add" method="post" class="row align-items-end">
                <div class="col-md-3 mb-2">
                    <label class="form-label small" data-i18n="settings_tags_label_name">Etiket AdÄ±</label>
                    <input type="text" name="name" class="form-control"
                        data-i18n="[placeholder]settings_tags_placeholder_name" placeholder="Ã–rn: Fatura" required>
                </div>
                <div class="col-md-2 mb-2">
                    <label class="form-label small" data-i18n="settings_tags_label_color">Renk SeÃ§in</label>
                    <input type="color" name="color" class="form-control" value="#3498db" title="Etiket Rengi"
                        style="height: 42px; padding: 2px;">
                </div>
                <div class="col-md-5 mb-2">
                    <label class="form-label small" data-i18n="settings_tags_label_desc">AÃ§Ä±klama (AI Kriteri)</label>
                    <input type="text" name="description" class="form-control"
                        data-i18n="[placeholder]settings_tags_placeholder_desc"
                        placeholder="Ã–rn: Ã–deme ve dekont mailleri..." required>
                </div>
                <div class="col-md-2 mb-2">
                    <button type="submit" class="btn btn-primary btn-block" style="height: 42px;">
                        <i class="fas fa-plus"></i> <span data-i18n="btn_add">Ekle</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <form action="/ui/settings/update-profile" method="post">
        <div class="settings-card">
            <h3><i class="fas fa-user-circle"></i> <span data-i18n="settings_profile_header">Profil Bilgileri</span>
            </h3>

            <div class="form-group">
                <label data-i18n="settings_label_fullname" class="form-label">Tam AdÄ±nÄ±z</label>
                <input type="text" name="full_name" value="{{ user.full_name }}" required>
            </div>

            <div class="form-group">
                <label data-i18n="settings_label_signature" class="form-label">E-posta Ä°mzanÄ±z</label>
                <textarea name="signature">{{ user.signature }}</textarea>
                <p class="helper-text" data-i18n="settings_helper_signature">OnayladÄ±ÄŸÄ±nÄ±z taslaklarÄ±n sonuna bu imza
                    otomatik eklenir.</p>
            </div>

            <div class="form-group">
                <label data-i18n="settings_label_verify" class="form-label">DoÄŸrulama: Panel Åifreniz</label>
                <input type="password" name="current_password" data-i18n="placeholder_password_verify"
                    placeholder="DeÄŸiÅŸiklikleri kaydetmek iÃ§in ÅŸifrenizi girin" required>
            </div>

            <button type="submit" class="save-btn">
                <i class="fas fa-user-check"></i> <span data-i18n="btn_update_profile">Profili GÃ¼ncelle</span>
            </button>
        </div>
    </form>

    <form action="/ui/settings/update-password" method="post" class="mt-4">
        <div class="settings-card">
            <h3><i class="fas fa-lock"></i> <span data-i18n="settings_password_header">Panel GiriÅŸ Åifresi</span></h3>

            <div class="form-group">
                <label data-i18n="settings_label_old_pass" class="form-label">Mevcut Åifre</label>
                <input type="password" name="old_password" required>
            </div>

            <div class="form-group">
                <label data-i18n="settings_label_new_pass" class="form-label">Yeni Åifre</label>
                <input type="password" name="new_password" required>
            </div>

            <button type="submit" class="save-btn btn-warning">
                <i class="fas fa-key"></i> <span data-i18n="btn_change_password">Åifreyi DeÄŸiÅŸtir</span>
            </button>
        </div>
    </form>

</div>

<!-- Edit Tag Modal -->
<div class="modal fade" id="editTagModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" data-i18n="settings_tags_edit_header">Etiketi DÃ¼zenle</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editTagForm" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label" data-i18n="settings_tags_label_name">Etiket AdÄ±</label>
                        <input type="text" name="name" id="editName" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" data-i18n="settings_tags_label_color">Renk</label>
                        <input type="color" name="color" id="editColor" class="form-control" style="height: 40px;"
                            required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" data-i18n="settings_tags_label_desc">AÃ§Ä±klama (AI Kriteri)</label>
                        <textarea name="description" id="editDesc" class="form-control" rows="3" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        data-i18n="btn_cancel">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary" data-i18n="btn_save">DeÄŸiÅŸiklikleri Kaydet</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function openEditModal(id, name, color, desc) {
        document.getElementById('editTagForm').action = "/ui/settings/tags/update/" + id;
        document.getElementById('editName').value = name;
        document.getElementById('editColor').value = color;
        document.getElementById('editDesc').value = desc;

        var modal = new bootstrap.Modal(document.getElementById('editTagModal'));
        modal.show();
    }
</script>
<script src="/mail_ai/app/static/js/translations.js?v=6"></script>
<script src="/mail_ai/app/static/js/language_engine.js?v=6"></script>
{% endblock %}