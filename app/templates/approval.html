<!DOCTYPE html>
<html>
<head>
    <!-- TÃ¼rkÃ§e karakter ve encoding problemi olmamasÄ± iÃ§in -->
    <meta charset="utf-8">
    <title>Mail AI Assistant</title>
</head>

<body>

    <!-- SayfanÄ±n ana baÅŸlÄ±ÄŸÄ± -->
    <h2>Mail AI Assistant â€“ Onay EkranÄ±</h2>

    <!-- EÄŸer backend tarafÄ± 'mail' gÃ¶ndermiÅŸse -->
    {% if mail %}

        <hr>

        <!-- Gelen mailin temel bilgileri -->
        <p><b>GÃ¶nderen:</b> {{ mail.from }}</p>
        <p><b>Konu:</b> {{ mail.subject }}</p>

        <!-- Gelen mailin iÃ§eriÄŸi -->
        <h3> Gelen Mail</h3>

        <!-- <pre> etiketi mail formatÄ±nÄ± bozmadan gÃ¶sterir -->
        <pre>{{ mail.body }}</pre>

        <!-- AI tarafÄ±ndan yazÄ±lan cevap -->
        <h3> AI Cevap TaslaÄŸÄ± (DÃ¼zenlenebilir)</h3>

        <!--
        Bu form:
        - textarea iÃ§eriÄŸini
        - /ui/update/{mail_id} endpoint'ine gÃ¶nderir
        -->
        <form method="post" action="/ui/update/{{ mail._id }}">
            <textarea
                name="reply_draft"
                rows="10"
                cols="100"
            >{{ mail.reply_draft }}</textarea>

            <br><br>

            <!-- KullanÄ±cÄ± dÃ¼zenlemeyi kaydeder -->
            <button type="submit">
                 DeÄŸiÅŸiklikleri Kaydet
            </button>
        </form>

        <br>

        <!-- Maili onayla -->
        <!-- Bu iÅŸlem maili n8n'e gÃ¶nderilmeye hazÄ±r hale getirir -->
        <form method="post" action="/ui/approve/{{ mail._id }}">
            <button type="submit">
                Onayla ve GÃ¶nder
            </button>
        </form>

        <br>

        <!-- Maili iptal et -->
        <!-- Bu mail bir daha gÃ¶nderilmez -->
        <form method="post" action="/ui/cancel/{{ mail._id }}">
            <button type="submit">
                 Ä°ptal Et
            </button>
        </form>

    {% else %}

        <!-- Bekleyen mail yoksa -->
        <p>ğŸ“­ Bekleyen mail yok</p>

    {% endif %}

    <hr>

    <!-- Daha Ã¶nce gÃ¶nderilen mailler -->
    <h3>ğŸ“¤ Daha Ã–nce GÃ¶nderilen Mailler</h3>

    {% if sent_mails and sent_mails|length > 0 %}

        <!-- Basit bir tablo -->
        <table border="1" cellpadding="5" cellspacing="0">
            <tr>
                <th>AlÄ±cÄ±</th>
                <th>Konu</th>
                <th>GÃ¶nderilen Cevap</th>
                <th>Tarih</th>
            </tr>

            {% for mail in sent_mails %}
            <tr>
                <td>{{ mail.to }}</td>
                <td>{{ mail.subject }}</td>
                <td>
                    <!-- Mail cevabÄ±nÄ±n formatÄ± bozulmasÄ±n -->
                    <pre>{{ mail.reply_draft }}</pre>
                </td>
                <td>{{ mail.created_at }}</td>
            </tr>
            {% endfor %}
        </table>

    {% else %}

        <!-- HenÃ¼z hiÃ§ mail gÃ¶nderilmediyse -->
        <p>HenÃ¼z gÃ¶nderilmiÅŸ mail yok.</p>

    {% endif %}

</body>
</html>
