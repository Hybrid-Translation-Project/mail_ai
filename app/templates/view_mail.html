{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/view_html.css">
{% endblock %}

{% block content %}
<div class="view-container">
    <div class="d-flex justify-content-between mb-3 align-items-center">
        <button onclick="history.back()" class="btn btn-outline-secondary btn-sm" style="color: #ccc; border-color: #444;">â† Geri DÃ¶n</button>
        <span class="text-muted small">Mail ID: {{ mail._id }}</span>
    </div>

    <div class="mail-header">
        <h4 class="text-white mb-3">{{ mail.subject }}</h4>
        <div class="meta-row">
            <span><strong>Kimden:</strong> <span class="text-primary">{{ mail.from }}</span></span>
            <span>ğŸ“… {{ mail.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
        </div>
        <div class="meta-row align-items-center mt-2">
            <span><strong>Durum:</strong> 
                {% if mail.status == 'SENT' %}
                    <span class="status-badge sent">âœ… GÃ–NDERÄ°LDÄ°</span>
                {% elif mail.status == 'CANCELED' %}
                    <span class="status-badge canceled">ğŸš« Ä°PTAL EDÄ°LDÄ° / REDDEDÄ°LDÄ°</span>
                {% elif mail.status == 'WAITING_APPROVAL' %}
                    <span class="status-badge waiting">â³ ONAY BEKLÄ°YOR</span>
                {% else %}
                    <span class="badge bg-secondary">{{ mail.status }}</span>
                {% endif %}
            </span>
            
            {% if mail.decision %}
            <span class="small text-muted">
                Karar: 
                {% if mail.decision == 'approve' %} <span class="text-success">Kabul</span>
                {% elif mail.decision == 'reject' %} <span class="text-danger">Ret</span>
                {% else %} <span class="text-secondary">NÃ¶tr</span> {% endif %}
            </span>
            {% endif %}
        </div>
    </div>

    <div class="mail-body">
{{ mail.body }}
    </div>

    {% if mail.reply_draft and mail.status == 'SENT' %}
    <div class="mt-4 p-3 rounded" style="border-left: 4px solid #28a745; background: #1a2e1e;">
        <h6 class="text-success mb-2">âœ… KarÅŸÄ± Tarafa GÃ¶nderilen Cevap:</h6>
        <div style="color: #ccc; font-style: italic; white-space: pre-wrap; font-size: 0.95rem;">{{ mail.reply_draft }}</div>
    </div>
    {% endif %}
    
    {% if mail.decision == 'reject' and mail.status == 'SENT' %}
    <div class="mt-4 p-3 rounded" style="border-left: 4px solid #dc3545; background: #2c1a1a;">
        <h6 class="text-danger mb-2">ğŸš« Red CevabÄ± GÃ¶nderildi:</h6>
        <div style="color: #ccc; font-style: italic; white-space: pre-wrap; font-size: 0.95rem;">{{ mail.reply_draft }}</div>
        <p class="small text-muted mt-2 mb-0">* Bu iÅŸlem iÃ§in gÃ¶rev oluÅŸturulmamÄ±ÅŸtÄ±r.</p>
    </div>
    {% endif %}
</div>
{% endblock %}