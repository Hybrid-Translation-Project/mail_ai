{% extends "base.html" %}

{% block extra_css %}
    <link rel="stylesheet" href="/static/css/history.css">
    <style>
        /* Arama sonuÃ§larÄ± iÃ§in stil (Dashboard ile uyumlu) */
        .search-result-card {
            background: #1e1e1e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: transform 0.2s;
        }
        .search-result-card:hover {
            border-color: #bb86fc;
            transform: translateY(-2px);
        }
        .similarity-score {
            font-size: 0.7rem;
            background: #333;
            padding: 2px 6px;
            border-radius: 4px;
            color: #4caf50;
        }
    </style>
{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <div>
        <h2 style="margin: 0;">ğŸ“‚ <span data-i18n="history_title">GÃ¶nderilen & Ä°ptal Edilenler</span></h2>
        <p style="color: #666; font-size: 0.9rem; margin-top: 5px;" data-i18n="history_subtitle">Son 50 iÅŸlem listeleniyor.</p>
    </div>
</div>

<div style="margin-bottom: 25px; display: flex; gap: 10px;">
    <div style="position: relative; flex-grow: 1;">
        <i class="fas fa-search" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #666;"></i>
        <input type="text" id="searchInput" 
               placeholder="GeÃ§miÅŸte Ara: 'Ahmet Bey teklifi', 'GeÃ§en ayki sunum'..." 
               style="width: 100%; padding: 12px 12px 12px 40px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; color: #fff; font-size: 1rem;">
    </div>
    <button id="searchBtn" class="btn btn-primary" style="background: #bb86fc; color: #000; font-weight: bold; border: none;">
        Ara
    </button>
</div>

<div id="search-view" style="display: none;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3 style="margin: 0;">ğŸ” Arama SonuÃ§larÄ±</h3>
        <button id="clearSearchBtn" class="btn btn-sm btn-secondary" style="border: 1px solid #444;">
            âŒ Kapat
        </button>
    </div>
    <div id="searchResultsContainer">
        </div>
</div>

<div id="default-view">
    <div class="table-responsive" style="background: #1a1a1a; border-radius: 8px; border: 1px solid #333;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead style="background: #252525; border-bottom: 1px solid #333;">
                <tr>
                    <th style="padding: 15px; text-align: left;" data-i18n="history_th_date">Tarih</th>
                    <th style="padding: 15px; text-align: left;" data-i18n="history_th_to">Kime / Muhatap</th>
                    <th style="padding: 15px; text-align: left;" data-i18n="history_th_subject">Konu (Ä°ncelemek iÃ§in tÄ±kla)</th>
                    <th style="padding: 15px; text-align: center;" data-i18n="history_th_status">Durum</th>
                    <th style="padding: 15px; text-align: center;" data-i18n="history_th_action">Ä°ÅŸlem</th>
                </tr>
            </thead>
            <tbody>
                {% for mail in mails %}
                <tr style="border-bottom: 1px solid #222;">
                    <td style="padding: 15px; color: #888; font-size: 0.9rem;">{{ mail.created_at.strftime('%d.%m %H:%M') }}</td>
                    <td style="padding: 15px; font-weight: 500;">{{ mail.from }}</td>
                    
                    <td style="padding: 15px;">
                        <a href="/ui/view/{{ mail._id }}" style="color: #fff; text-decoration: none; font-weight: bold; display: block;">
                            {{ mail.subject }} <span style="font-size: 0.8em; color: #bb86fc;">ğŸ”—</span>
                        </a>
                    </td>

                    <td style="padding: 15px; text-align: center;">
                        {% if mail.status == 'SENT' %}
                            <span style="background: rgba(40, 167, 69, 0.2); color: #28a745; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold;" data-i18n="badge_sent">
                                GÃ–NDERÄ°LDÄ°
                            </span>
                        {% else %}
                            <span style="background: rgba(220, 53, 69, 0.2); color: #dc3545; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold;" data-i18n="badge_cancelled">
                                Ä°PTAL EDÄ°LDÄ°
                            </span>
                        {% endif %}
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        <form action="/ui/mail/delete/{{ mail._id }}" method="post" style="display:inline;" onsubmit="return confirm('Delete this record? / Bu kaydÄ± silmek istediÄŸine emin misin?');">
                            <button type="submit" style="background: none; border: none; color: #cf6679; cursor: pointer; font-size: 1rem;" title="ArÅŸivden KaldÄ±r">
                                ğŸ—‘ï¸
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if not mails %}
    <div style="text-align: center; padding: 50px; color: #666;">
        <p data-i18n="history_empty">HenÃ¼z iÅŸlem geÃ§miÅŸi bulunmuyor.</p>
    </div>
    {% endif %}
</div> {% endblock %}

{% block extra_js %}
    <script src="/static/js/translations.js"></script>
    <script src="/static/js/language_engine.js"></script>
    <script src="/static/js/search.js"></script>
{% endblock %}