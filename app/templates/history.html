{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/history.css">
{% endblock %}

{% block content %}
<section class="page-header">
    <div>
        <h2 class="page-title">ğŸ“‚ <span data-i18n="history_title">GÃ¶nderilen & Ä°ptal Edilenler</span></h2>
        <p class="page-subtitle" data-i18n="history_subtitle">Son 50 iÅŸlem listeleniyor.</p>
    </div>
</section>

<div class="search-toolbar">
    <div class="search-input-wrap">
        <i class="fas fa-search search-input-icon"></i>
        <input type="text" id="searchInput" class="form-control search-input"
            placeholder="GeÃ§miÅŸte Ara: 'Ahmet Bey teklifi', 'GeÃ§en ayki sunum'...">
    </div>
    <button id="searchBtn" class="btn btn-primary search-btn">Ara</button>
</div>

<div id="search-view" class="search-view">
    <div class="search-results-header">
        <h3 class="search-results-title">ğŸ” Arama SonuÃ§larÄ±</h3>
        <button id="clearSearchBtn" class="btn btn-sm btn-secondary">âŒ Kapat</button>
    </div>
    <div id="searchResultsContainer"></div>
</div>

<div id="default-view">
    <div class="table-responsive app-table-wrapper">
        <table class="table app-table align-middle mb-0">
            <thead>
                <tr>
                    <th scope="col" data-i18n="history_th_date">Tarih</th>
                    <th scope="col" data-i18n="history_th_to">Kime / Muhatap</th>
                    <th scope="col" data-i18n="history_th_subject">Konu (Ä°ncelemek iÃ§in tÄ±kla)</th>
                    <th scope="col" class="text-center" data-i18n="history_th_status">Durum</th>
                    <th scope="col" class="text-center" data-i18n="history_th_action">Ä°ÅŸlem</th>
                </tr>
            </thead>
            <tbody>
                {% for mail in mails %}
                <tr>
                    <td class="history-date">{{ mail.created_at.strftime('%d.%m %H:%M') }}</td>
                    <td class="history-to">{{ mail.from }}</td>
                    <td>
                        <a href="/ui/view/{{ mail._id }}" class="history-subject-link">
                            {{ mail.subject }} <span class="history-link-icon">ğŸ”—</span>
                        </a>
                    </td>
                    <td class="text-center">
                        {% if mail.status == 'SENT' %}
                        <span class="history-status history-status-sent" data-i18n="badge_sent">GÃ–NDERÄ°LDÄ°</span>
                        {% else %}
                        <span class="history-status history-status-canceled" data-i18n="badge_cancelled">Ä°PTAL
                            EDÄ°LDÄ°</span>
                        {% endif %}
                    </td>
                    <td class="text-center">
                        <div class="history-actions">
                            {% if mail.status == 'CANCELED' %}
                            <form action="/ui/restore/{{ mail._id }}" method="post" class="inline-form">
                                <button type="submit" class="btn btn-success btn-sm restore-btn"
                                    title="Gelen Kutusuna Geri YÃ¼kle">â™»ï¸</button>
                            </form>
                            {% endif %}

                            <form action="/ui/mail/delete/{{ mail._id }}" method="post" class="inline-form"
                                onsubmit="return confirm('Delete this record? / Bu kaydÄ± silmek istediÄŸine emin misin?');">
                                <button type="submit" class="btn btn-danger btn-sm delete-btn"
                                    title="ArÅŸivden KaldÄ±r">ğŸ—‘ï¸</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if not mails %}
    <div class="empty-state">
        <p class="empty-text" data-i18n="history_empty">HenÃ¼z iÅŸlem geÃ§miÅŸi bulunmuyor.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/translations.js"></script>
<script src="/static/js/language_engine.js"></script>
<script src="/static/js/search.js"></script>
{% endblock %}